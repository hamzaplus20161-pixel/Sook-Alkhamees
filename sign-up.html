<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©</title>

<!--=====================  STYLE  =====================-->
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:"Cairo",sans-serif;}
body{background:#f7f7f7;}

.container{
    max-width:420px;margin:40px auto;background:white;padding:25px;
    border-radius:12px;box-shadow:0 4px 14px #0002;
}

h2{color:#ff7a33;text-align:center;margin-bottom:25px;}

label{font-weight:700;margin-top:12px;display:block;color:#444;}
input{
    width:100%;padding:12px;margin-top:6px;border-radius:6px;border:1px solid #ccc;font-size:15px;
}
button{
    width:100%;padding:12px;margin-top:18px;border:none;border-radius:6px;
    font-size:17px;font-weight:700;background:#ff7a33;color:white;cursor:pointer;
}
button:hover{background:#e46a25;}

#switch{text-align:center;margin-top:15px;color:#555;cursor:pointer;}

#profileImg{
    width:120px;height:120px;border-radius:50%;border:3px dashed #ff7a33;
    display:flex;justify-content:center;align-items:center;margin:15px auto;
    background:#fff2e6;font-weight:700;color:#ff7a33;cursor:pointer;
}
#profileImg img{width:100%;height:100%;border-radius:50%;object-fit:cover;}

#errorMsg{color:red;text-align:center;margin-top:8px;font-weight:700;}
#successMsg{color:green;text-align:center;margin-top:8px;font-weight:700;}
</style>
</head>

<body>

<div class="container" id="signupBox">

<h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>

<div id="profileImg">Ø§Ø®ØªØ± ØµÙˆØ±Ø©</div>
<input type="file" id="imgInput" accept="image/*" style="display:none;">

<label>Ø§Ù„Ø§Ø³Ù…</label>
<input type="text" id="name">

<label>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
<input type="email" id="email">

<label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
<input type="password" id="password">

<button onclick="signup()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
<div id="errorMsg"></div>
<div id="successMsg"></div>

<div id="switch" onclick="showLogin()">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>

</div>




<!--===================== LOGIN PAGE =====================-->

<div class="container" id="loginBox" style="display:none;">

<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>

<label>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
<input type="email" id="loginEmail">

<label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
<input type="password" id="loginPassword">

<button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
<div id="loginError"></div>

<div id="switch" onclick="showSignup()">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</div>

</div>




<!--===================== OTP PAGE =====================-->

<div class="container" id="otpBox" style="display:none;">

<h2>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²</h2>

<label>Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…</label>
<input type="text" id="otp" maxlength="6">

<button onclick="verifyOTP()">ØªØ£ÙƒÙŠØ¯</button>
<div id="otpError"></div>

</div>




<!--===================== HOME PAGE =====================-->

<div class="container" id="homeBox" style="display:none;">

<h2>Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ğŸ‰</h2>

<div style="text-align:center;">
    <img id="homeImg" style="width:140px;height:140px;border-radius:50%;object-fit:cover;border:3px solid #ff7a33;">
    <h3 id="homeName" style="margin-top:15px;color:#333;"></h3>
</div>

<button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

</div>





<!--=====================  SCRIPT  =====================-->
<script type="module">

/*================= SUPABASE CONFIG =================*/
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const SUPABASE_URL = "https://nzdvboeaocarlcgoeixu.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56ZHZib2Vhb2NhcmxjZ29laXh1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NTI3NTAsImV4cCI6MjA4MDMyODc1MH0.mA-hf6902t2xLH_kUedHmy0sQrjGIAmoCqN2rHZ6K_E";

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);


/*================= SWITCH PAGES =================*/
window.showLogin = () => {
    signupBox.style.display = "none";
    loginBox.style.display = "block";
};
window.showSignup = () => {
    loginBox.style.display = "none";
    signupBox.style.display = "block";
};


/*================= SIGNUP =================*/
let uploadedImageURL = null;

profileImg.onclick = () => imgInput.click();
imgInput.onchange = () => {
    let file = imgInput.files[0];
    let reader = new FileReader();
    reader.onload = () => profileImg.innerHTML = `<img src="${reader.result}">`;
    reader.readAsDataURL(file);
};

async function signup() {
    errorMsg.textContent = "";
    successMsg.textContent = "";

    if (name.value.trim() === "" || email.value === "" || password.value === "") {
        errorMsg.textContent = "Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        return;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
    const { data, error } = await supabase.auth.signUp({
        email: email.value,
        password: password.value
    });

    if (error) {
        errorMsg.textContent = error.message;
        return;
    }

    let userId = data.user.id;

    // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (imgInput.files.length) {
        let file = imgInput.files[0];
        let fileName = `profile-${Date.now()}-${file.name}`;

        let { error: uploadErr } = await supabase.storage.from("profiles").upload(fileName, file);
        if (!uploadErr) {
            uploadedImageURL = `${SUPABASE_URL}/storage/v1/object/public/profiles/${fileName}`;
        }
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø¬Ø¯ÙˆÙ„ users_data
    await supabase.from("users_data").insert({
        id: userId,
        name: name.value,
        image: uploadedImageURL
    });

    signupBox.style.display = "none";
    otpBox.style.display = "block";

    successMsg.textContent = "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø¥ÙŠÙ…ÙŠÙ„";
}



/*================= LOGIN =================*/
async function login() {
    loginError.textContent = "";

    const { data, error } = await supabase.auth.signInWithPassword({
        email: loginEmail.value,
        password: loginPassword.value
    });

    if (error) {
        loginError.textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
        return;
    }

    loginBox.style.display = "none";
    otpBox.style.display = "block";
}



/*================= VERIFY OTP =================*/
async function verifyOTP() {
    otpError.textContent = "";

    const { data, error } = await supabase.auth.verifyOtp({
        email: email.value || loginEmail.value,
        token: otp.value,
        type: "email"
    });

    if (error) {
        otpError.textContent = "Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­";
        return;
    }

    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    let { data: user } = await supabase.auth.getUser();
    let userId = user.user.id;

    let { data: profile } = await supabase.from("users_data").select("*").eq("id", userId).single();

    homeImg.src = profile.image || "";
    homeName.textContent = profile.name;

    otpBox.style.display = "none";
    homeBox.style.display = "block";
}



/*================= LOGOUT =================*/
async function logout() {
    await supabase.auth.signOut();
    homeBox.style.display = "none";
    loginBox.style.display = "block";
}

</script>

</body>
</html>